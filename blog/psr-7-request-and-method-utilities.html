<!DOCTYPE html><html lang=en xml:lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=Content-Type content="text/html; charset=UTF-8"><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0"><meta name=theme-color content=#70b49c><meta name=msapplication-navbutton-color content=#70b49c><meta name=apple-mobile-web-app-status-bar-style content=black-translucent><meta name=mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-capable content=yes><meta name=application-name content="Julien Guittard"><meta name=apple-mobile-web-app-title content="Julien Guittard"><meta name=msapplication-starturl content=/ ><link rel=canonical itemprop=url href=http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html><link rel=alternate type=application/rss+xml title=RSS href=/feed.xml><title>Julien Guittard &nbsp;|&nbsp;PSR-7 Request and Method Utilities</title><meta name=author itemprop=author content="Julien Guittard"><link rel=author href="http://google.com/+JulienGuittardWebpage?rel=author"><meta name=description itemprop=description content="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor."><meta property=og:locale content=en_US><meta property=og:type content=article><meta property=og:title content="PSR-7 Request and Method Utilities"><meta property=og:url content=http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html><meta property=og:image content=http://julien.guittard.io/thumbs/ ><meta property=og:site_name content="Julien Guittard"><meta property=article:publisher content=http://www.facebook.com/julien.guittard><meta property=article:author content=https://www.facebook.com/julien.guittard><meta property=article:published_time content=2017-01-26T13:50:00-04:00><meta property=og:description content="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor."><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="PSR-7 Request and Method Utilities"><meta name=twitter:description content="Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor."><meta name=twitter:site content=@julienguittard><meta name=twitter:creator content=@julienguittard><meta name=twitter:card content=summary><link rel=manifest href=/manifest.json><link rel=icon type=image/x-icon href=/favicon.ico><link rel=icon href=/icons/icon-128.png><link rel=icon href=/icons/icon-192.png><link rel=icon href=/icons/icon-120.png><link rel=icon href=/icons/icon-120.png sizes=120x120><link rel=icon href=/icons/icon-152.png sizes=152x152><link rel=icon href=/icons/icon-167.png sizes=167x167><link rel=icon href=/icons/icon-180.png sizes=180x180><link rel=stylesheet type=text/css href=/styles/main.css><!--[if lt IE 9]>
  	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  	<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]--><script type=text/javascript>WebFontConfig={google:{families:["Open+Sans:300,400,700:latin","Lato:700,900:latin"]}},function(){var t=document.createElement("script");t.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",t.type="text/javascript",t.async="true";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script></head><body itemscope itemtype=https://schema.org/WebPage><header class="header push-down-45" role=banner itemscope itemtype=http://schema.org/WPHeader><div class=container><div class="logo pull-left" itemprop=publisher itemscope id=jg-organization itemtype=https://schema.org/Organization><a href=/ rel=home itemprop=url><span itemprop=logo itemscope itemtype=https://schema.org/ImageObject><img itemprop=contenturl src=http://julien.guittard.io/images/logo.png alt=JG width=352 height=140><meta itemprop=width content=352><meta itemprop=height content=140><meta itemprop=url content=http://julien.guittard.io/images/logo.png></span><meta itemprop=name content="Julien Guittard"></a></div><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#top-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button></div><nav class="navbar navbar-default" role=navigation><div class="collapse navbar-collapse" id=top-navbar-collapse><ul class=navigation role=menu itemscope itemtype=http://www.schema.org/SiteNavigationElement><li role=menuitem><a href=http://julien.guittard.io/ itemprop=url><span itemprop=name>Home</span></a></li><li role=menuitem><a href=http://julien.guittard.io/blog/ itemprop=url><span itemprop=name>Blog</span></a></li><li role=menuitem><a href=http://julien.guittard.io/about-me/ itemprop=url><span itemprop=name>About me</span></a></li><li role=menuitem><a href=http://julien.guittard.io/contact/ itemprop=url><span itemprop=name>Contact</span></a></li></ul></div></nav><div class="hidden-xs hidden-sm"><a href=# class="search__container js--toggle-search-mode"><span class="glyphicon glyphicon-search"></span></a><div class=social><a href=# class=social__container><span class="glyphicon glyphicon-heart"></span></a><ul class=social__dropdown><li><a href=https://www.twitter.com/julienguittard target=_blank class=social__container title="Follow me on Twitter"><span class=zocial-twitter></span></a></li><li><a href=https://www.linkedin.com/in/julienguittard target=_blank class=social__container title="Hire me on LinkedIn"><span class=zocial-linkedin></span></a></li><li><a href=https://github.com/jguittard target=_blank class=social__container title="Clone me on Github"><span class=zocial-github></span></a></li><li><a href=/feed.xml target=_blank class=social__container title="Read me through RSS"><span class=zocial-rss></span></a></li></ul></div></div></div></header><div class=search-panel><div class=container><div class=row><div class=col-xs-12><form action=/search itemprop=potentialAction itemscope itemtype=https://schema.org/SearchAction><meta itemprop=target content="http://julien.guittard.io/search?q="><input itemprop=query-input type=search name=q class="search-panel__form js--search-panel-text" placeholder="Begin typing for search"><p class=search-panel__text>Press enter to see results or esc to cancel.</p></form></div></div></div></div><div class=container><article class="boxed push-down-60" itemscope itemtype=http://schema.org/BlogPosting itemref=jg-organization><link itemprop=mainEntityOfPage href=http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html><header class=meta><figure itemprop=image itemscope itemtype=http://schema.org/ImageObject><meta itemprop=url content=http://julien.guittard.io/images/posts/2017-01-26-psr-7-request-and-method-utilities/blog-image-8.jpg><img src=http://julien.guittard.io/images/posts/2017-01-26-psr-7-request-and-method-utilities/blog-image-8.jpg class=wp-post-image alt="Post poster" width=1138 height=493 itemprop=contenturl><meta itemprop=width content=1138><meta itemprop=height content=493></figure><div class=meta__container><div class=row><div class="col-xs-12 col-sm-8"><div class=meta__info><span class=meta__author><figure><img src="https://avatars2.githubusercontent.com/u/5320213?s=90&v=4" alt="Author avatar" width=30 height=30></figure><a href=/about target=_blank rel=author>Julien</a> in <a href=/blog/categories/news/news>News</a> </span><span class=meta__date role=contentinfo><span class="glyphicon glyphicon-calendar"></span> &nbsp; <time itemprop=datePublished datetime=2017-01-26T13:50:00-04:00>January 26, 2017</time><meta itemprop=dateModified content=2017-01-26T13:50:00-04:00></span></div></div><div class="col-xs-12 col-sm-4"><div class=meta__comments><span class="glyphicon glyphicon-comment"></span> &nbsp; <a href=http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html#disqus_thread data-disqus-identifier=/blog/psr-7-request-and-method-utilities.html>Comments</a></div></div></div></div></header><div class=row><div class="col-xs-10 col-xs-offset-1 col-md-8 col-md-offset-2 push-down-60"><section class=post-content><h1 itemprop=headline>PSR-7 Request and Method Utilities</h1><h3 itemprop=description>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor.</h3><div itemprop=articleBody><p>We all know the standard HTTP request methods and status codes, right? Or do we?</p><p>We definitely know whether or not they should be integers or strings, and/or how string values should be normalized, right?</p><p>And our IDEs can <em>totally</em> autocomplete them, right?</p><p>Oh, that’s not the case?</p><p>Some time ago, a few folks floated the idea of creating a utility repository related to the <a href=http://www.php-fig.org/psr/psr-7/ >PSR-7</a> <a href=https://github.com/php-fig/http-message>psr/http-message</a> package, but containing some useful bits such as constants for HTTP request methods and status codes.</p><p>Six months ago, we released it… but didn’t publicize it. I remembered that fact today while writing some unit tests that were utilizing the package, and thought I’d finally write it up.</p><p>The package is <a href=https://github.com/php-fig/http-message-util>fig/http-message-util</a>, and is available via Composer and Packagist:</p><div class="language-bash highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=nv>$ </span>composer require fig/http-message-util
</code></pre></div></div><p>It provides two interfaces:</p><ul><li><code class=highlighter-rouge>Fig\Http\Message\RequestMethodInterface</code>, containing constants for HTTP request method values.</li><li><code class=highlighter-rouge>Fig\Http\Message\StatusCodeInterface</code>, containing constants for HTTP status code values.</li></ul><p>The constants are prefixed with <code class=highlighter-rouge>METHOD_</code> and <code class=highlighter-rouge>STATUS_</code>, respectively, and use the standard names as presented in the various IETF specifications that originally define them.</p><p>As an example, I could write middleware that looks like this:</p><div class="language-php highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nx>Fig\Http\Message\RequestMethodInterface</span> <span class=k>as</span> <span class=nx>RequestMethod</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Fig\Http\Message\StatusCodeInterface</span> <span class=k>as</span> <span class=nx>StatusCode</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Interop\Http\ServerMiddleware\DelegateInterface</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Interop\Http\ServerMiddleware\MiddlewareInterface</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Psr\Http\Message\ServerRequestInterface</span><span class=p>;</span>
<span class=k>use</span> <span class=nx>Zend\Diactoros\EmptyResponse</span><span class=p>;</span>

<span class=k>class</span> <span class=nc>RequestMethodNegotiation</span> <span class=k>implements</span> <span class=nx>MiddlewareInterface</span>
<span class=p>{</span>
    <span class=k>private</span> <span class=nv>$alwaysAllowed</span> <span class=o>=</span> <span class=p>[</span>
        <span class=nx>RequestMethod</span><span class=o>::</span><span class=na>METHOD_HEAD</span><span class=p>,</span>
        <span class=nx>RequestMethod</span><span class=o>::</span><span class=na>METHOD_OPTIONS</span><span class=p>,</span>
    <span class=p>];</span>

    <span class=k>private</span> <span class=nv>$map</span><span class=p>;</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>__construct</span><span class=p>(</span><span class=k>array</span> <span class=nv>$map</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>map</span> <span class=o>=</span> <span class=nv>$map</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=k>public</span> <span class=k>function</span> <span class=nf>process</span><span class=p>(</span><span class=nx>ServerRequestInterface</span> <span class=nv>$request</span><span class=p>,</span> <span class=nx>DelegateInterface</span> <span class=nv>$delegate</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=nv>$path</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>getUri</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPath</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span> <span class=nb>isset</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>map</span><span class=p>[</span><span class=nv>$path</span><span class=p>]))</span> <span class=p>{</span>
            <span class=k>return</span> <span class=nv>$delegate</span><span class=o>-&gt;</span><span class=na>process</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=nv>$method</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>getMethod</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=nb>in_array</span><span class=p>(</span><span class=nv>$method</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>alwaysAllowed</span><span class=p>,</span> <span class=kc>true</span><span class=p>))</span> <span class=p>{</span>
            <span class=c1>// Always allowed
</span>            <span class=k>return</span> <span class=nv>$delegate</span><span class=o>-&gt;</span><span class=na>process</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=nb>in_array</span><span class=p>(</span><span class=nv>$method</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>map</span><span class=p>[</span><span class=nv>$path</span><span class=p>],</span> <span class=kc>true</span><span class=p>))</span> <span class=p>{</span>
            <span class=c1>// In map; proceed
</span>            <span class=k>return</span> <span class=nv>$delegate</span><span class=o>-&gt;</span><span class=na>process</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// Not allowed!
</span>        <span class=k>return</span> <span class=k>new</span> <span class=nx>EmptyResponse</span><span class=p>(</span><span class=nx>StatusCode</span><span class=o>::</span><span class=na>STATUS_METHOD_NOT_ALLOWED</span><span class=p>,</span> <span class=p>[</span>
            <span class=s1>'Allow'</span> <span class=o>=&gt;</span> <span class=nb>implode</span><span class=p>(</span><span class=s1>','</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>map</span><span class=p>[</span><span class=nv>$path</span><span class=p>]);</span>
        <span class=p>]);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>The things to notice in the above are:</p><ul><li><p><code class=highlighter-rouge>$alwaysAllowed</code> uses the <code class=highlighter-rouge>RequestMethodInterface</code> constants in order to provide a list of always allowed HTTP methods; it doesn’t use strings, which are prone to typos.</p></li><li><p>When a dis-allowed method is encountered, we use a <code class=highlighter-rouge>StatusCodeInterface</code> constant to provide the status. This allows us to use code completion, but also signify the <em>intent</em> of the code. Integer values are great, but unless you have all the status codes memorized, it’s often easy to forget what they <em>mean</em>.</p></li></ul><p>The other thing to notice is that I alias the interfaces to shorter names. We require interfaces to have the <code class=highlighter-rouge>Interface</code> suffix in FIG, but in situations like these, I don’t particularly care that the constants are defined in an <em>interface</em>; I just want to consume them. This is one of the reasons PHP supports aliasing.</p><p>If you’re not already using this package, and use PSR-7 middleware, I highly recommend checking the package out!</p></div></section><div class=row><div class="col-xs-12 col-sm-6"><div class=post-comments><a class="btn btn-primary" href=http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html#disqus_thread data-disqus-identifier=/blog/psr-7-request-and-method-utilities.html></a></div></div><div class="col-xs-12 col-sm-6"><div class=social-icons><a href="https://facebook.com/sharer.php?u=http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html" rel=nofollow target=_blank title="Share on Facebook" class=social-icons__container><span class=zocial-facebook></span></a> <a href="https://twitter.com/intent/tweet?text=PSR-7 Request and Method Utilities&url=http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html&via=julienguittard" rel=nofollow target="
            " title="Share on Twitter" class=social-icons__container><span class=zocial-twitter></span></a> <a href="https://plus.google.com/share?url=http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html" rel=nofollow target=_blank title="Share on Google" class=social-icons__container><span class=zocial-google></span></a></div></div></div><div class=row><div class="col-xs-12 col-sm-6"><div class=post-author id=author-box role=contentinfo itemprop=author itemscope itemtype=http://schema.org/Person><h6>Written By</h6><hr><figure itemprop=image itemscope itemtype=http://schema.org/ImageObject><img src="https://avatars2.githubusercontent.com/u/5320213?s=90&v=4" alt="Author avatar" itemprop=contenturl><meta itemprop=url content="https://avatars2.githubusercontent.com/u/5320213?s=90&v=4"><meta itemprop=width content=90><meta itemprop=height content=90></figure><h5><a href=/about itemprop=url><span itemprop=name>Julien Guittard</span></a></h5><span class=post-author__text></span></div></div><div class="col-xs-12 col-sm-6"><div class=tags><h6>Tags</h6><meta itemprop=keywords content="php, programming, psr-7"><hr><a href=/blog/tags/php/ class=tags__link rel=tag>php</a> <a href=/blog/tags/programming/ class=tags__link rel=tag>programming</a> <a href=/blog/tags/psr-7/ class=tags__link rel=tag>psr-7</a></div></div></div><div class="disqus-comments push-down-45"><div id=disqus_thread></div><script>var disqus_shortname="julienguittard",disqus_config=function(){this.page.url="http://julien.guittard.io/blog/psr-7-request-and-method-utilities.html",this.page.identifier="psr-7-request-and-method-utilities",this.page.title="PSR-7 Request and Method Utilities"};!function(){var t=document,e=t.createElement("script");e.src="//"+disqus_shortname+".disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div><div class=related-stories><h6>Related Stories</h6><hr></div></div></div></article></div><footer class=footer role=contentinfo><div class=container><div class="col-xs-12 col-md-3"><div class="widget-about push-down-30"><img src=http://julien.guittard.io/images/logo.png alt=Logo width=176 height=70><br><span class=footer__text>Hi, I'm Julien Guittard, welcome to my personal website. I am a web application architect and trainer.</span><br><br><div class="social-icons widget-social-icons"><a href=https://www.twitter.com/julienguittard class=social-icons__container title="Follow me on Twitter"><span class=zocial-twitter></span> </a><a href=https://www.linkedin.com/in/julienguittard class=social-icons__container title="Hire me on LinkedIn"><span class=zocial-linkedin></span> </a><a href=https://github.com/jguittard class=social-icons__container title="Clone me on Github"><span class=zocial-github></span> </a><a href=/feed.xml class=social-icons__container title="Read me through RSS"><span class=zocial-rss></span></a></div></div></div><div class="col-xs-12 col-md-3"><div class="tags widget-tags"><h6>Tags</h6><hr><a href=/blog/tags/:tag/http class=tags__link rel=tag>http</a> <a href=/blog/tags/:tag/middleware class=tags__link rel=tag>middleware</a> <a href=/blog/tags/:tag/php class=tags__link rel=tag>php</a> <a href=/blog/tags/:tag/programming class=tags__link rel=tag>programming</a> <a href=/blog/tags/:tag/psr-7 class=tags__link rel=tag>psr-7</a></div></div><div class="col-xs-12 col-md-3"><div class="widget-navigation push-down-30"><h6>Navigation</h6><hr><ul class=navigation><li><a href=http://julien.guittard.io/ >Home</a></li><li><a href=http://julien.guittard.io/blog/ >Blog</a></li><li><a href=http://julien.guittard.io/about-me/ >About me</a></li><li><a href=http://julien.guittard.io/contact/ >Contact</a></li></ul></div></div><div class="col-xs-12 col-md-3"><div class="widget-contact push-down-30"><h6>Contact</h6><hr></div></div></div></footer><section class=copyrights><div class=container><div class=row><div class="col-xs-12 col-sm-6">Copyright 2009-2018 &copy; by Julien Guittard.</div><div class="col-xs-12 col-sm-6"><div class=copyrights--right>Made with <i class="glyphicon glyphicon-heart"></i> using <a href=https://jekyllrb.com/ target=_blank>Jekyll</a> and <a href=https://pages.github.com target=_blank>Github Pages</a>.</div></div></div></div></section><script src=http://julien.guittard.io/jquery/dist/jquery.js charset=utf-8></script><script src=http://julien.guittard.io/sass-bootstrap/dist/js/bootstrap.js charset=utf-8></script><script src=http://julien.guittard.io/underscore/underscore.js charset=utf-8></script><script src=http://julien.guittard.io/scripts/main.js></script><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-65618920-1","auto"),ga("send","pageview")</script><script id=dsq-count-scr src=//julienguittard.disqus.com/count.js async></script></body></html>